# 各种worker

## web worker

另外开辟一个独立的 JS 线程来运行这些高耗时的 JS 代码

特点：

1. 只能服务于新建它的页面，不同页面之间不能共享同一个 Web Worker。
2. 当页面关闭时，该页面新建的 Web Worker 也会随之关闭，不会常驻在浏览器中。

## service worker

一个服务器与浏览器之间的中间人角色，如果网站中注册了service worker那么它可以拦截当前网站所有的请求，进行判断（需要编写相应的判断程序），如果需要向服务器发起请求的就转给服务器，如果可以直接使用缓存的就直接返回缓存不再转给服务器。从而大大提高浏览体验。

### 特点
- 在页面中注册并安装成功后，运行于浏览器后台，不受页面刷新的影响，可以监听和截拦作用域范围内所有页面的 HTTP 请求。

- Service Worker的各类操作都被设计为异步，用以避免一些长时间的阻塞操作。这

- 在web worker的基础上增加了离线缓存的能力
- 本质上充当Web应用程序（服务器）与浏览器之间的代理服务器（可以拦截全站的请求，并作出相应的动作->由开发者指定的动作）
- 创建有效的离线体验（将一些不常更新的内容缓存在浏览器，提高访问体验）
- 由事件驱动的,具有生命周期
- 可以访问cache和indexDB
- 支持推送
- 并且可以让开发者自己控制管理缓存的内容以及版本
- 通过注册之后，可以独立于浏览器在后台运行，控制我们的一个或者多个页面。如果我们的页面在多个窗口中打开，Service Worker不会重复创建。

### 注意事项

- 不能访问DOM
- 它设计为完全异步，同步API（如XHR和localStorage）不能在service worker中使用。可以使用fetch替代`XMLHttpRequest` 实现异步请求(ajax)。
- 网站必须使用 HTTPS。除了使用本地开发环境调试时(如域名使用 `localhost`)

### 生命周期

```
install -> installed -> actvating -> Active -> Activated -> Redundant
```

安装中、安装后、激活中、激活、激活后、我废了。

### 应用场景

1. 监控页面的卡顿、崩溃，通过心跳
2. mock数据
3. PWA

>Progressive Web Apps :
>
>- **渐进增强** – 能够让每一位用户使用，无论用户使用什么浏览器，因为它是始终以渐进增强为原则。
>- **响应式用户界面** – 适应任何环境：桌面电脑，智能手机，笔记本电脑，或者其他设备。
>- **不依赖网络连接** – 通过 Service Workers 可以在离线或者网速极差的环境下工作。
>- **类原生应用** – 有像原生应用般的交互和导航给用户原生应用般的体验，因为它是建立在 app shell model 上的。
>- **持续更新** – 受益于 Service Worker 的更新进程，应用能够始终保持更新。
>- **安全** – 通过 HTTPS 来提供服务来防止网络窥探，保证内容不被篡改。
>- **可发现** – 得益于 W3C manifests 元数据和 Service Worker 的登记，让搜索引擎能够找到 web 应用。
>- **再次访问** – 通过消息推送等特性让用户再次访问变得容易。
>- **可安装** – 允许用户保留对他们有用的应用在主屏幕上，不需要通过应用商店。
>- **可连接性** – 通过 URL 可以轻松分享应用，不用复杂的安装即可运行。



### 相关资料

[Service Worker 应用详解]([https://lzw.me/a/pwa-service-worker.html#9%20%E5%85%B6%E4%BB%96%E7%9B%B8%E5%85%B3%E5%8F%82%E8%80%83](https://lzw.me/a/pwa-service-worker.html#9 其他相关参考))

[Service Worker初探](https://juejin.im/post/6844903972759666701)

[Service Worker 从入门到出门](https://juejin.im/post/6844903887296528398)