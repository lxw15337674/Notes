# XSS
XSS（cross site script）跨站脚本攻击，其原本缩写是 CSS，但为了和层叠样式表(Cascading Style Sheet)有所区分，因而在安全领域叫做 XSS。
指在网站中注入恶意代码，当用户浏览时，执行恶意代码，对用户浏览器进行控制或者获取用户隐私数据。
## 影响
1. 窃取cookie。
2. 监听用户行为，比如输入账号密码后直接发送到黑客服务器。
3. 修改DOM伪造登录表单。
4. 在页面中生成浮窗广告。

## 分类
### 反射型
简单地把用户输入的数据 “反射” 给浏览器，

一般常见于通过URL传递参数的功能，如网站搜索、跳转等。

攻击步骤：
1. 攻击者构造出特殊的URL，其实包含恶意代码。
2. 用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。
3. 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。

常见场景：
1. 通过诱导用户点击一个恶意连接。

### 存储型
将用户输入的数据存储在服务端，当浏览器请求数据时，脚本从服务器上传回并执行。

一般常见于带有用户保存数据的网站功能，如发帖、评论、私信等。

常见场景：
1. 攻击者写一篇包含恶意代码的文章或评论，文章或评论发表后，所有访问该文章或评论的用户，都会在他们的浏览器中执行这段恶意代码。

与反射型区别：存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。


### 文档型（基于DOM）
文档型的 XSS 攻击并不会经过服务端，而是作为中间人的角色，在数据传输过程劫持到网络数据包，然后修改里面的 html 文档。

常见场景：
1. wifi挟持
2. DNS劫持

与前两种区别：
DOM 型 XSS 攻击中，发生在浏览器端。而其他两种 XSS 都属于服务端的安全漏洞。

### 总结
![image](https://segmentfault.com/img/remote/1460000012693785?w=1031&h=767)

## 防范措施
XSS特点是让恶意脚本直接能在浏览器中执行。

一个信念，两个利用。
1. 输入检查：不相信用户的输入，对用户输入的任何东西都进行转义。
2. 设置httpOnly：设置Cookie的HttpOnly属性，js便无法读取cookie的值。
3. 开启CSP，即浏览器中的内容安全策略，就是设立白名单。它的核心思想就是服务器决定浏览器加载哪些资源，可阻止白名单以外的资源加载和运行。具体来说可以完成以下功能:
    - 禁止加载外域代码，防止复杂的攻击逻辑。
    - 禁止外域提交，网站被攻击后，用户的数据不会泄露到外域。
    - 禁止内联脚本执行（规则较严格，目前发现 GitHub 使用）。
    - 禁止未授权的脚本执行（新特性，Google Map 移动版在使用）。
    - 合理使用上报可以及时发现 XSS，利于尽快修复问题。



## 引用
[浅说 XSS 和 CSRF](https://github.com/dwqs/blog/issues/68)
[如何防止XSS攻击？](https://juejin.im/post/5bad9140e51d450e935c6d64)
[常见六大Web安全攻防解析 ](https://github.com/ljianshu/Blog/issues/56)